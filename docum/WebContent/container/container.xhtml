<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="/WEB-INF/includes/layout.xhtml">
	<ui:param name="selectedMenuItem" value="4" />
	<f:metadata>
		<f:event type="preRenderView" listener="#{containerBean.loadPage}"></f:event>
	</f:metadata>
	<ui:define name="content">
		<h:form prependId="false">
			<h:panelGrid columns="2" styleClass="containersLayoutTable"
				id="voyagesLayoutTable">

				<p:panel id="containersPanel" style="text-align:center"
					styleClass="toggle-panel">
					<f:facet name="header">
						<h:outputText id="containerTitle"
							value="#{containerBean.containersTitle}" />
					</f:facet>
					<p:autoComplete id="VoyageSearchBoxId"
						value="#{containerBean.selectedVoyage}"
						completeMethod="#{containerBean.voyageAutocomplete}" var="voyage"
						itemValue="#{voyage}" itemLabel="#{voyage.voyageInfo}"
						forceSelection="true" converter="voyagePresentationConverter"
						selectListener="#{containerBean.voyageSelect}"
						onSelectUpdate="containers,infoPanel,containerTitle">
					</p:autoComplete>

					<ui:include src="/WEB-INF/includes/baseCrudToolBar.xhtml">
						<ui:param name="bean" value="#{containerBean}" />
						<ui:param name="gridId" value="containers" />
						<ui:param name="update" value="infoPanel" />
						<ui:param name="newObject" value="newObject" />
						<ui:param name="editObject" value="editObject" />
						<ui:param name="beforeDeleteObject" value="beforeDeleteObject" />
						<ui:param name="refreshObjects" value="refreshObjects" />
					</ui:include>

					<p:dataTable selectionMode="single" styleClass="cellSmallText"
						id="containers" var="container"
						value="#{containerBean.containers}"
						selection="#{containerBean.container}"
						rowStyleClass="#{container.color}" update="infoPanel">

						<p:column sortBy="#{container.number}"
							filterBy="#{container.number}" filterMatchMode="contains">
							<f:facet name="header">Номер</f:facet>
							<h:outputText value="#{container.number}" />
						</p:column>

						<p:column sortBy="#{container.invoiceInLine}"
							filterBy="#{container.invoiceInLine}" filterMatchMode="contains">
							<f:facet name="header">Инвойс</f:facet>
							<h:outputText value="#{container.invoiceInLine}" />
						</p:column>

						<p:column sortBy="#{container.orderInLine}"
							filterBy="#{container.orderInLine}" filterMatchMode="contains">
							<f:facet name="header">Заказ</f:facet>
							<h:outputText value="#{container.orderInLine}" />
						</p:column>

						<p:column sortBy="#{container.billOfLadingInLine}"
							filterBy="#{container.billOfLadingInLine}"
							filterMatchMode="contains">
							<f:facet name="header">Коносамент</f:facet>
							<h:outputText value="#{container.billOfLadingInLine}" />
						</p:column>

						<p:column sortBy="#{container.cargoInLine}"
							filterBy="#{container.cargoInLine}" filterMatchMode="contains">
							<f:facet name="header">Груз</f:facet>
							<h:outputText value="#{container.cargoInLine}" />
						</p:column>

						<p:column sortBy="#{container.city}" filterBy="#{container.city}"
							filterMatchMode="contains">
							<f:facet name="header">Город</f:facet>
							<h:outputText value="#{container.city}" />
						</p:column>

						<p:column sortBy="#{container.state}"
							filterBy="#{container.state}">
							<f:facet name="header">Статус</f:facet>
							<h:outputText value="#{container.state}" />
						</p:column>

					</p:dataTable>

				</p:panel>
				<h:panelGroup id="infoPanel" layout="block">
				<p:panel style="text-align:center" rendered="#{containerBean.container != null}">
					<f:facet name="header">
						<h:outputText value="#{containerBean.container.number}" />
					</f:facet>
					<h:panelGroup id="lazyContainerInfo" layout="block"
						rendered="#{containerBean.isSelected}">
						<h:outputText styleClass="olive-color" value="Статус: " />
						<h:outputText value="#{containerBean.container.state}" />						
						
						<h:panelGroup rendered="#{containerBean.container.invoiceInLine != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Инвойс: " />
						<h:outputText value="#{containerBean.container.invoiceInLine}" />
						</h:panelGroup>
						
						<h:panelGroup rendered="#{containerBean.container.orderInLine != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Заказ: " />
						<h:outputText value="#{containerBean.container.orderInLine}" />
						</h:panelGroup>
						
						<h:panelGroup rendered="#{containerBean.container.billOfLadingInLine != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Коносамент: " />
						<h:outputText
							value="#{containerBean.container.billOfLadingInLine}" />
						</h:panelGroup>	
						
						<h:panelGroup rendered="#{containerBean.container.city != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Город: " />
						<h:outputText value="#{containerBean.container.city}" />
						</h:panelGroup>
						
						<h:panelGroup rendered="#{containerBean.container.loadingPort != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Погрузка: " />
						<h:outputText value="#{containerBean.container.loadingPort}" />
						<h:outputText value=", " />
						<h:outputText value="#{containerBean.container.loadingDate}">
							<f:convertDateTime dateStyle="medium" type="date" />
						</h:outputText>
						</h:panelGroup>
						
						<h:panelGroup rendered="#{containerBean.container.dischargePort != null}">
						<br />
						<h:outputText styleClass="olive-color" value="Выгрузка: " />
						<h:outputText value="#{containerBean.container.dischargePort}" />
						<h:outputText value=", " />
						<h:outputText value="#{containerBean.container.dischargeDate}">
							<f:convertDateTime dateStyle="medium" type="date" />
						</h:outputText>
						</h:panelGroup>
					</h:panelGroup>
					<ui:repeat value="#{containerBean.containerCargoes}" var="wcargo">
						<p:panel header="#{wcargo.article}, #{wcargo.articleCategory}"
							styleClass="container-cargo-panel">
							<h:outputText styleClass="olive-color" value="Поставщик: " />
							<h:outputText value="#{wcargo.supplier}" />
							<ul>
								<ui:repeat value="#{wcargo.features}" var="feature">
									<li><h:outputText styleClass="olive-color"
											value="#{feature.feature.name}: " /> <h:outputText
											value="#{feature.value}" /></li>
								</ui:repeat>
							</ul>
							Упаковка
							<ul>
								<ui:repeat value="#{wcargo.activeCargoCondition.cargoPackages}"
									var="pack">
									<li><h:outputText styleClass="olive-color"
											value="#{pack.measure.name}: " /> <h:outputText
											value="#{pack.count}">
											<f:convertNumber maxFractionDigits="2" />
										</h:outputText> <h:panelGroup rendered="#{not empty pack.calibres}">
											<ul>
												<ui:repeat value="#{pack.calibres}" var="calibre">
													<li><h:outputText styleClass="olive-color"
															value="#{calibre.calibreValue}: " /> <h:outputText
															value="#{calibre.packageCount}">
															<f:convertNumber maxFractionDigits="2" />
														</h:outputText></li>
												</ui:repeat>
											</ul>
										</h:panelGroup>
									</li>
								</ui:repeat>
							</ul>
						</p:panel>
					</ui:repeat>

				</p:panel>
				</h:panelGroup>
			</h:panelGrid>
		</h:form>


		<ui:include src="/container/dialog/containerDlg.xhtml">
			<ui:param name="bean" value="#{containerBean.containerDlg}" />
			<ui:param name="gridId" value="containers" />
			<ui:param name="title" value="title" />
			<ui:param name="update" value="infoPanel" />
			<ui:param name="rendered" value="#{containerBean.containerDlg != null}" />
		</ui:include>
		
		<ui:include src="/WEB-INF/includes/deleteConfirmation.xhtml">
			<ui:param name="message"
				value="Удалить контейнер '#{containerBean.container.number}'?" />
			<ui:param name="gridId" value="containers" />
			<ui:param name="bean" value="#{containerBean}" />
			<ui:param name="update" value="infoPanel" />
			<ui:param name="deleteObject" value="deleteObject" />	
		</ui:include>


	</ui:define>
	
</ui:composition>
</html>