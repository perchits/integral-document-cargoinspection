<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="/WEB-INF/includes/layout.xhtml">
	<ui:define name="content">
		<h:form prependId="false">
			<h:panelGrid columns="2" styleClass="voyagesLayoutTable"
				id="voyagesLayoutTable">
				<p:panel id="voyagesPanel" header="Судозаходы"
					style="text-align:center" styleClass="toggle-panel">
					<ui:include src="/WEB-INF/includes/crudToolBar.xhtml">
						<ui:param name="bean" value="#{voyageBean}" />
						<ui:param name="dataTableId" value="voyages" />
					</ui:include>
					<p:dataTable id="voyages" var="voyage"
						value="#{voyageBean.allObjects}" selectionMode="single"
						selection="#{voyageBean.voyage}" update="voyagesLayoutTable">
						<p:column sortBy="#{voyage.vessel.name}"
							filterBy="#{voyage.vessel.name}" filterMatchMode="contains">
							<f:facet name="header">
							Судно 
						</f:facet>
							<h:outputText value="#{voyage.vessel.name}" />
						</p:column>
						<p:column sortBy="#{voyage.number}" filterBy="#{voyage.number}"
							filterMatchMode="contains">
							<f:facet name="header">
							Рейс  
						</f:facet>
							<h:outputText value="#{voyage.number}" />
						</p:column>
						<p:column sortBy="#{voyage.arrivalDate}"
							filterBy="#{voyage.arrivalDate}" filterMatchMode="contains">
							<f:facet name="header">
							Дата прибытия  
						</f:facet>
							<h:outputText value="#{voyage.arrivalDate}">
								<f:convertDateTime dateStyle="medium" type="date" />
							</h:outputText>
						</p:column>
						
						<p:column sortBy="#{voyage.containerCount}"
							filterBy="#{voyage.containerCount}" filterMatchMode="contains">
							<f:facet name="header">
							 Контейнеров
						</f:facet>
							<h:outputText value="" />						
						</p:column>
						
					</p:dataTable>
					<h3>#{voyageBean.containerCount}</h3>
				</p:panel>
				<p:panel id="infoPanel" 
					style="text-align:center">
					<f:facet name="header">
					<h:outputText value="#{voyageBean.voyage.vessel.name}, " />
					<h:outputText value="#{voyageBean.voyage.number}, " />					
					<h:outputText value="#{voyageBean.voyage.arrivalDate}">
								<f:convertDateTime dateStyle="medium" type="date" />
							</h:outputText>
					</f:facet>
					<h:panelGrid columns="2" styleClass="infoLayoutTable">


						<p:dataTable id="containers" var="container"
							value="#{voyageBean.containers}">							
							<p:column>
								<h:outputText value="#{container.number}" />
								<f:facet name="header">Контейнеры</f:facet>
							</p:column>
						</p:dataTable>


						<h:panelGroup>
							<p:dataTable id="purchaseOrders" var="order"
								value="#{voyageBean.orders}">								
								<p:column>
									<h:outputText value="#{order.number}" />
									<f:facet name="header">Заказы</f:facet>
								</p:column>
							</p:dataTable>


							<p:dataTable id="invoices" var="invoice"
								value="#{voyageBean.invoices}">								
								<p:column>
									<h:outputText value="#{invoice.number}" />
									<f:facet name="header">Инвойсы</f:facet>
								</p:column>
							</p:dataTable>



							<p:dataTable id="billOfLadings" var="bill"
								value="#{voyageBean.billOfLadings}">
								
								<p:column>
									<h:outputText value="#{bill.number}" />
									<f:facet name="header">Коносаменты</f:facet>
								</p:column>
							</p:dataTable>


						</h:panelGroup>

					</h:panelGrid>
				</p:panel>
			</h:panelGrid>
		</h:form>

		<p:outputPanel id="dialogPanel">
			<h:form prependId="false">
				<p:dialog width="340" id="dialog" widgetVar="dialog" modal="true"
					header="#{voyageBean.title}">
					<p:outputPanel id="dialogContent">
						<h:panelGroup>

							<h:panelGrid width="100%" columns="2" cellpadding="5">
								<h:outputLabel for="voyageVessel" value="Судно: *" />
								<h:selectOneMenu id="voyageVessel"
									styleClass="ui-inputfield ui-widget ui-state-default ui-corner-all"
									value="#{voyageBean.selectedVessel}">
									<f:converter converterId="vesselConverter" />
									<f:selectItem itemLabel="Выберите судно..." itemValue=""
										noSelectionOption="true" itemDisabled="true" />
									<f:selectItems value="#{voyageBean.vessels}" var="vsls"
										itemLabel="#{vsls.name}" />
								</h:selectOneMenu>
								<h:outputLabel for="voyageNumber" value="Рейс: *" />
								<p:inputText size="30" value="#{voyageBean.voyage.number}"
									id="voyageNumber" required="true" label="Рейс" />

								<h:outputLabel for="voyageArrivalDate" value="Дата прибытия:" />
								<p:calendar value="#{voyageBean.voyage.arrivalDate}"
									id="voyageArrivalDate" label="Дата прибытия"
									pattern="dd.MM.yyyy" />

								<h:outputLabel for="voyageFinished" value="Завершено:" />
								<h:selectBooleanCheckbox size="30"
									value="#{voyageBean.voyage.finished}" id="voyageFinished"
									label="Завершено">
								</h:selectBooleanCheckbox>

								<f:facet name="footer">
									<p:commandButton actionListener="#{voyageBean.saveObject}"
										value="OK" update="voyages,growl"
										oncomplete="handleOKRequest(args,dialog,'dialog')" />
									<p:commandButton type="reset" value="Отмена" update="growl"
										onclick="dialog.hide()" />

								</f:facet>
							</h:panelGrid>

						</h:panelGroup>
					</p:outputPanel>
				</p:dialog>
			</h:form>
		</p:outputPanel>


		<ui:include src="/WEB-INF/includes/confirmation.xhtml">
			<ui:param name="bean" value="#{voyageBean}" />
			<ui:param name="message"
				value="Удалить судозаход '#{voyageBean.voyage.number}'?" />
		</ui:include>

		<h:outputScript name="dialog.js" library="js" />

	</ui:define>
</ui:composition>
</html>