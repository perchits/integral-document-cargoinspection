<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="/WEB-INF/includes/layout.xhtml">
	<ui:define name="content">	
	<h:form prependId="false">
		<h:panelGroup layout="block" styleClass="crud-menu">
			<p:toolbar styleClass="crud-menu">
					<p:toolbarGroup align="left">
						<p:commandButton type="push" value="Добавить"
							update="dialogPanel,growl" image="ui-icon-document"
							actionListener="#{voyageView.newVoyage}"
							oncomplete="dialog.show()" />

						<p:commandButton type="push" value="Правка"
							update="dialogPanel,growl"
							actionListener="#{voyageView.editVoyage}"
							oncomplete="beforeShow(dialog,'voyages')"
							image="ui-icon ui-icon-wrench" />

						<p:commandButton type="push" value="Удалить"
							oncomplete="beforeShow(confirmation,'voyages')"
							image="ui-icon ui-icon-minus" update="confirmationPanel,growl" />

						<p:commandButton type="push" update="voyages" value="Обновить"
							actionListener="#{voyageView.refreshVoyages}"
							image="ui-icon ui-icon-arrowreturnthick-1-w" />

					</p:toolbarGroup>
				</p:toolbar>

		</h:panelGroup>

		<p:panel header="Рейсы судов" style="text-align:center"
			styleClass="toggle-panel">
				<p:dataTable id="voyages" var="voyage" value="#{voyageView.allVoyages}"
					selectionMode="single" selection="#{voyageView.voyage}">
					<p:column sortBy="#{voyage.vessel.name}" filterBy="#{voyage.vessel.name}"
						filterMatchMode="contains">
						<f:facet name="header">
							Судно 
						</f:facet>
						<h:outputText value="#{voyage.vessel.name}" />
					</p:column>
					<p:column sortBy="#{voyage.number}" filterBy="#{voyage.number}"
						filterMatchMode="contains">
						<f:facet name="header">
							Рейс  
						</f:facet>
						<h:outputText value="#{voyage.number}" />
					</p:column>
					<p:column sortBy="#{voyage.arrivalDate}" filterBy="#{voyage.arrivalDate}"
						filterMatchMode="contains">
						<f:facet name="header">
							Дата прибытия  
						</f:facet>						  
						<h:outputText value="#{voyage.arrivalDate}">
						<f:convertDateTime dateStyle="medium" type="date" />
						</h:outputText>
					</p:column>
					<p:column sortBy="#{voyage.finished}" filterBy="#{voyage.finished}"
						filterMatchMode="contains">
						<f:facet name="header">
							Завершено  
						</f:facet>
						<h:selectBooleanCheckbox disabled="true" value="#{voyage.finished}" />
					</p:column>

				</p:dataTable>						
		</p:panel>
			 
	</h:form>

	<p:outputPanel id="dialogPanel">
		<h:form prependId="false">
			<p:dialog width="340" id="dialog" widgetVar="dialog" modal="true"
				header="#{voyageView.title}">
				<p:outputPanel id="dialogContent">
					<h:panelGroup>

						<h:panelGrid width="100%" columns="2" cellpadding="5">
							<h:outputLabel for="voyageVessel" value="Судно: *" />
							<h:selectOneMenu id="voyageVessel"
								valueChangeListener="#{voyageView.vesselSelected}">
								<f:selectItems value="#{voyageView.vessels}" var="vsls"
								 itemLabel="#{vsls.name}" itemValue="#{vsls.id}"/>
							</h:selectOneMenu>
							<h:outputLabel for="voyageNumber" value="Рейс: *" />
							<p:inputText size="30" value="#{voyageView.voyage.number}"
								id="voyageNumber" required="true" label="Рейс" />								
							
							<h:outputLabel for="voyageArrivalDate" value="Дата прибытия: *" />
							<p:calendar value="#{voyageView.voyage.arrivalDate}" 
							id="voyageArrivalDate" label="Дата прибытия" pattern="dd.MM.yyyy"/>
														
							<h:outputLabel for="voyageFinished" value="Завершено: *" />
							<h:selectBooleanCheckbox size="30" value="#{voyageView.voyage.finished}"
								id="voyageFinished" label="Завершено" >								
							</h:selectBooleanCheckbox>

							<f:facet name="footer">
								<p:commandButton 
									actionListener="#{voyageView.saveVoyageAction}" value="OK"
									update="voyages,growl"
									oncomplete="handleOKRequest(args,dialog,'dialog')" />
								<p:commandButton type="reset" value="Отмена" update="growl"
									onclick="dialog.hide()" />

							</f:facet>
						</h:panelGrid>

					</h:panelGroup>
				</p:outputPanel>
			</p:dialog>
		</h:form>
	</p:outputPanel>
	
	<p:outputPanel id="confirmationPanel">
			<h:form prependId="false" id="confirmationForm">
				<p:confirmDialog
					message="Удалить судозаход '#{voyageView.voyage.number}'?"
					header="Удаление..." severity="alert" widgetVar="confirmation">

					<p:commandButton value="ОК" update="voyages,growl"
						actionListener="#{voyageView.deleteVoyage}"
						oncomplete="confirmation.hide()" />
					<p:commandButton value="Отмена" onclick="confirmation.hide()"
						type="button" />
				</p:confirmDialog>
			</h:form>
		</p:outputPanel>
	
	<h:outputScript name="dialog.js" library="js" />

	</ui:define>
</ui:composition>
</html>