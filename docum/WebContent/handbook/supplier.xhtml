<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.prime.com.tr/ui">

<ui:composition template="/WEB-INF/includes/layout.xhtml">
	<ui:define name="content">
	    <h:form prependId="false">
		<h:panelGroup layout="block" styleClass="crud-menu">
			
				<p:menubar autoSubmenuDisplay="false" styleClass="crud-menu">
					<p:menuitem value="Добавить" update="dialogPanel,growl"
						actionListener="#{supplier.newSupplier}"
						oncomplete="handleDialogShow()" icon="ui-icon ui-icon-plus" />
					<p:menuitem value="Правка" update="dialogPanel,growl"
						actionListener="#{supplier.editSupplier}"
						oncomplete="handleDialogShow()" icon="ui-icon ui-icon-wrench" />
					<p:menuitem value="Удалить" url="#" update="dialogPanel,growl" icon="ui-icon ui-icon-minus" />
					<p:menuitem update="suppliers" value="Обновить"
						actionListener="#{supplier.refreshSuppliers}"
						icon="ui-icon ui-icon-arrowreturnthick-1-w" />
				</p:menubar>
			
		</h:panelGroup>
		<p:panel header="Поставщики" style="text-align:center"
			styleClass="toggle-panel">
			

				<p:dataTable id="suppliers" var="sup" value="#{supplier.suppliers}"
					selectionMode="single" selection="#{supplier.supplier}">
					<p:column sortBy="#{sup.name}" filterBy="#{sup.name}"
						filterMatchMode="contains">
						<f:facet name="header">
										Наименование  
									</f:facet>
						<h:outputText value="#{sup.name}" />
					</p:column>
				</p:dataTable>

			
		</p:panel>
</h:form>
		<p:outputPanel id="dialogPanel">
			<h:form prependId="false">
				<p:dialog width="480" id="dialog" widgetVar="dialog" modal="true"
					header="#{supplier.title}">
					<p:outputPanel id="dialogContent">
						<h:panelGroup>

							<h:panelGrid width="100%" columns="2" cellpadding="5">
								<h:outputLabel for="supname" value="Наименование: *" />
								<p:inputText size="60" value="#{supplier.supplier.name}" id="supname"
									required="true" label="Наименование" />

								<f:facet name="footer">
									<p:commandButton
										actionListener="#{supplier.saveSupplierAction}" value="OK"
										update="suppliers,growl"
										oncomplete="handleLoginRequest(xhr, status, args)" />
									<p:commandButton type="reset" value="Отмена" update="growl"
										onclick="dialog.hide()" />
										
								</f:facet>
							</h:panelGrid>

						</h:panelGroup>
					</p:outputPanel>
				</p:dialog>
			</h:form>
		</p:outputPanel>

		<script type="text/javascript">
			function handleLoginRequest(xhr, status, args) {
				if (args.validationFailed) {
					jQuery('#dialog').parent().effect("shake", {
						times : 3
					}, 100);
				} else {
					dialog.hide();
					jQuery('#loginLink').fadeOut();
				}
			}
			
			function handleDialogShow(xhr, status, args) {
				//if (!args.failShow) {
					dialog.show();
				//}	
			}

			function editLastDatatableRow() {
				jQuery('.ui-datatable-data tr').last().find(
						'span.ui-icon-pencil').each(function() {
					jQuery(this).click()
				});
			}
		</script>

	</ui:define>
</ui:composition>
</html>